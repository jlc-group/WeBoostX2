# üöÄ Facebook Sync System - Complete Guide

## üìã ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö

‡∏£‡∏∞‡∏ö‡∏ö sync Facebook data ‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡πÅ‡∏ö‡∏ö ‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡πÅ‡∏´‡∏•‡πà‡∏á‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á `facebook_posts_performance` ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ dashboard ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á JOIN ‡∏´‡∏•‡∏≤‡∏¢ table

## üéØ ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß

### ‚úÖ ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÄ‡∏î‡∏¥‡∏°

- Dashboard ‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏ï‡πâ‡∏≠‡∏á JOIN ‡∏´‡∏•‡∏≤‡∏¢ table
- Facebook URLs ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ (403 Forbidden)
- ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏Å‡πá‡∏ö‡∏ñ‡∏≤‡∏ß‡∏£
- Performance data ‡∏Å‡∏£‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡πÉ‡∏ô‡∏´‡∏•‡∏≤‡∏¢ table

### ‚úÖ ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

- ‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô `facebook_posts_performance` table ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
- ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß‡πÅ‡∏•‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô `media_storage`
- ‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î URLs ‡∏ó‡∏µ‡πà‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏
- ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error

## üìä ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô facebook_posts_performance

‡∏ï‡∏≤‡∏£‡∏≤‡∏á `facebook_posts_performance` ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô:

```sql
-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
post_id, channel_acc_id, post_type, url, caption

-- ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ)
thumbnail_url, local_thumbnail_id

-- Performance Metrics
performance_score, engagement_rate, ctr
impressions, impressions_unique, reach, clicks, likes, comments, shares

-- Video Data
video_duration, video_views, total_time_watched, average_time_watched

-- Ads Data
ads_count, ads_total_media_cost, ads_details (JSON)

-- Timestamps
create_time, update_time, last_sync_at
```

## üõ†Ô∏è Scripts ‡∏´‡∏•‡∏±‡∏Å

### 1. sync_facebook_posts_performance.py

**‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö** - ‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ó‡∏∏‡∏Å source

```bash
# Sync ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
python sync_facebook_posts_performance.py

# Sync 7 ‡∏ß‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
python sync_facebook_posts_performance.py --days-back 7

# Sync post ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
python sync_facebook_posts_performance.py --post-id POST_ID

# Sync ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ regular posts (‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á foreign key error)
python sync_facebook_posts_performance.py --days-back 7 --posts-only
```

**Features:**

- ‚úÖ ‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å posts, videos, reels, ads, insights
- ‚úÖ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß‡πÅ‡∏•‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡∏ñ‡∏≤‡∏ß‡∏£
- ‚úÖ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì performance score (0-99.99)
- ‚úÖ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ ads cost ‡πÅ‡∏•‡∏∞ campaign data
- ‚úÖ Error handling ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö video posts

### 2. cleanup_expired_media.py

**‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏£‡∏∞‡∏ö‡∏ö** - ‡∏•‡∏ö URLs ‡∏ó‡∏µ‡πà‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏

```bash
python cleanup_expired_media.py
```

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:**

- üßπ ‡∏•‡∏ö 452 expired URLs
- üîÑ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï 297 performance records
- üìä ‡∏•‡∏î‡∏à‡∏≤‡∏Å 585 failed ‚Üí 133 failed downloads

### 3. facebook_sync_monitor.py

**Dashboard ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Admin** - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏∞‡∏ö‡∏ö

```bash
python facebook_sync_monitor.py
```

**‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:**

- üìà Sync Status (3,097 posts, 76.3% with images)
- üìÅ Media Storage (2,749 files, 95.2% success)
- üîÑ Recent Activity (1,274 posts synced in 24h)
- üèÜ Top 3 Performing Posts
- üö® Alerts ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà fresh

## üìà ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á

### üéØ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Dashboard

```sql
-- Query ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡πÑ‡∏î‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏ö (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á JOIN)
SELECT post_id, post_type, caption, thumbnail_url,
       performance_score, impressions, likes, comments, shares,
       ads_count, ads_total_media_cost
FROM facebook_posts_performance
WHERE last_sync_at >= CURRENT_DATE
ORDER BY performance_score DESC;
```

### üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô

- **3,097 posts** ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
- **2,364 posts (76.3%)** ‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
- **2,463 posts (79.5%)** ‡∏°‡∏µ ads data
- **66.5/100** average performance score
- **$42.5M** total ad spend tracked

### üñºÔ∏è Media Management

- **2,616 ‡∏£‡∏π‡∏õ** ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (95.2%)
- **147.9 MB** storage ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
- **133 failed** downloads (‡∏™‡πà‡∏ß‡∏ô‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏õ‡πá‡∏ô video content)

## üöÄ ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Dashboard

### 1. API Endpoint ‡∏á‡πà‡∏≤‡∏¢

```python
# ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á JOIN ‡∏´‡∏•‡∏≤‡∏¢ table ‡∏≠‡∏µ‡∏Å‡∏ï‡πà‡∏≠‡πÑ‡∏õ
def get_posts_for_dashboard():
    query = """
    SELECT post_id, post_type, caption, thumbnail_url,
           performance_score, impressions, likes, comments, shares,
           ads_total_media_cost, create_time
    FROM facebook_posts_performance
    WHERE thumbnail_url IS NOT NULL
    ORDER BY performance_score DESC
    LIMIT 50
    """
    return execute_query(query)
```

### 2. ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ

```html
<!-- thumbnail_url ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ó‡∏±‡∏ô‡∏ó‡∏µ -->
<img src="{{ post.thumbnail_url }}" alt="Post thumbnail" />
```

### 3. Performance Metrics

```python
# Performance score ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ
def get_performance_summary():
    return {
        'avg_score': 66.5,
        'top_posts': get_posts_above_score(80),
        'total_ad_spend': 42553376.03
    }
```

## ‚ö° Performance Improvements

### üîß Optimizations ‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÅ‡∏•‡πâ‡∏ß

- **Posts-only mode** ‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á foreign key constraint
- **Expired URL cleanup** ‡∏•‡∏î failed downloads 77%
- **Media caching** ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÑ‡∏°‡πà‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏
- **Batch processing** ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô

### üìä Monitoring

- **Real-time dashboard** ‡∏î‡πâ‡∏ß‡∏¢ `facebook_sync_monitor.py`
- **Automated alerts** ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà fresh
- **Storage statistics** ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö media usage

## üéâ ‡∏™‡∏£‡∏∏‡∏õ

‡∏£‡∏∞‡∏ö‡∏ö Facebook Sync ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ:

- ‚úÖ **Dashboard-ready** ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏ö‡πÉ‡∏ô table ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
- ‚úÖ **Image-complete** ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
- ‚úÖ **Performance-optimized** sync ‡πÄ‡∏£‡πá‡∏ß‡πÅ‡∏•‡∏∞‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£
- ‚úÖ **Monitoring-enabled** ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏î‡πâ‡∏ï‡∏•‡∏≠‡∏î‡πÄ‡∏ß‡∏•‡∏≤
- ‚úÖ **Error-resilient** ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error ‡πÑ‡∏î‡πâ‡∏î‡∏µ

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:** Dashboard ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å `facebook_posts_performance` table ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á JOIN ‡∏´‡∏•‡∏≤‡∏¢ table ‡πÅ‡∏•‡∏∞‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÅ‡∏™‡∏î‡∏á‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á 100%! üöÄ

